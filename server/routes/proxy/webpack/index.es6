import express from "express";
import glob from "glob";
import { get } from "lodash";
let httpProxy = require("http-proxy");
import config from "../../../../gulpfile.config";
export let router = express.Router({ mergeParams: true });
let webpackConfigs = glob.sync(`${config.tmpPath}/webpackConfigs/*.json`).map(c => require(`${process.cwd()}/${c}`));
webpackConfigs.forEach(webpackConfigOption => {
    let { gulpfileConfigField, entry, dest, port, relativePath } = webpackConfigOption;
    let buildConfig = get(config, gulpfileConfigField);
    let proxy = httpProxy.createProxyServer();
    router.get(`${config.baseUrl}js/${relativePath}*`, (req, res) => {
        proxy.web(req, res, {
            target: `http://localhost:${port}`,
            ws: true,
        });
    });
});
export default router;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZlci9yb3V0ZXMvcHJveHkvd2VicGFjay9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiT0FBTyxPQUFPLE1BQU0sU0FBUztPQUN0QixJQUFJLE1BQU0sTUFBTTtPQUNoQixFQUFFLEdBQUcsRUFBRSxNQUFNLFFBQVE7QUFDNUIsSUFBSSxTQUFTLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO09BSS9CLE1BQU0sTUFBTSw2QkFBNkI7QUFFaEQsT0FBTyxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7QUFFMUQsSUFBSSxjQUFjLEdBQVUsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLE1BQU0sQ0FBQyxPQUFPLHdCQUF3QixDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxPQUFPLENBQUMsR0FBRyxPQUFPLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQzVILGNBQWMsQ0FBQyxPQUFPLENBQUMsbUJBQW1CO0lBQ3hDLElBQUksRUFBRSxtQkFBbUIsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxZQUFZLEVBQUUsR0FBRyxtQkFBbUIsQ0FBQztJQUNuRixJQUFJLFdBQVcsR0FBa0IsR0FBRyxDQUFDLE1BQU0sRUFBRSxtQkFBbUIsQ0FBUSxDQUFDO0lBQ3pFLElBQUksS0FBSyxHQUFHLFNBQVMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO0lBQzFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxNQUFNLENBQUMsT0FBTyxNQUFNLFlBQVksR0FBRyxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUc7UUFDMUQsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFO1lBQ2xCLE1BQU0sRUFBRSxvQkFBb0IsSUFBSSxFQUFFO1lBQ2xDLEVBQUUsRUFBRSxJQUFJO1NBQ1QsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILGVBQWUsTUFBTSxDQUFDIiwiZmlsZSI6InNlcnZlci9yb3V0ZXMvcHJveHkvd2VicGFjay9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBleHByZXNzIGZyb20gXCJleHByZXNzXCI7XG5pbXBvcnQgZ2xvYiBmcm9tIFwiZ2xvYlwiO1xuaW1wb3J0IHsgZ2V0IH0gZnJvbSBcImxvZGFzaFwiO1xubGV0IGh0dHBQcm94eSA9IHJlcXVpcmUoXCJodHRwLXByb3h5XCIpO1xuaW1wb3J0IGNoYWxrIGZyb20gXCJjaGFsa1wiO1xuXG5pbXBvcnQgeyBKU0J1aWxkQ29uZmlnIH0gZnJvbSBcIi4uLy4uLy4uLy4uL2d1bHBmaWxlLmNvbmZpZy50eXBlc1wiO1xuaW1wb3J0IGNvbmZpZyBmcm9tIFwiLi4vLi4vLi4vLi4vZ3VscGZpbGUuY29uZmlnXCI7XG5cbmV4cG9ydCBsZXQgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoeyBtZXJnZVBhcmFtczogdHJ1ZSB9KTtcblxubGV0IHdlYnBhY2tDb25maWdzOiBhbnlbXSA9IGdsb2Iuc3luYyhgJHtjb25maWcudG1wUGF0aH0vd2VicGFja0NvbmZpZ3MvKi5qc29uYCkubWFwKGMgPT4gcmVxdWlyZShgJHtwcm9jZXNzLmN3ZCgpfS8ke2N9YCkpO1xud2VicGFja0NvbmZpZ3MuZm9yRWFjaCh3ZWJwYWNrQ29uZmlnT3B0aW9uID0+IHtcbiAgbGV0IHsgZ3VscGZpbGVDb25maWdGaWVsZCwgZW50cnksIGRlc3QsIHBvcnQsIHJlbGF0aXZlUGF0aCB9ID0gd2VicGFja0NvbmZpZ09wdGlvbjtcbiAgbGV0IGJ1aWxkQ29uZmlnOiBKU0J1aWxkQ29uZmlnID0gZ2V0KGNvbmZpZywgZ3VscGZpbGVDb25maWdGaWVsZCkgYXMgYW55O1xuICBsZXQgcHJveHkgPSBodHRwUHJveHkuY3JlYXRlUHJveHlTZXJ2ZXIoKTtcbiAgcm91dGVyLmdldChgJHtjb25maWcuYmFzZVVybH1qcy8ke3JlbGF0aXZlUGF0aH0qYCwgKHJlcSwgcmVzKSA9PiB7XG4gICAgcHJveHkud2ViKHJlcSwgcmVzLCB7XG4gICAgICB0YXJnZXQ6IGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH1gLFxuICAgICAgd3M6IHRydWUsXG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmV4cG9ydCBkZWZhdWx0IHJvdXRlcjtcbiJdfQ==
